#!/bin/bash
#build the linux version (amd64) of broker

if (( $# != 1 )); then
	echo "Illegal number of parameters"
	echo "usage: ./build [multistage|development]"
	exit 1
fi

command="$1"
case "${command}" in
	"multistage")
                     time docker build -f ./Dockerfile_multistage -t "test/broker:test" ../
                     ;;
        "development")
                      go get
                      CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build  -a -installsuffix cgo  -o broker
		      time docker build -f ./Dockerfile_development -t "test/broker:test" .
                      ;;
esac

#build the arm version of broker
#CGO_ENABLED=0  GOOS=linux GOARCH=arm go build  -a -installsuffix cgo  -o broker_arm
#docker build -f Dockerfile4Arm -t "fogflow/broker:arm"  .

#build broker for ARMv8
#CGO_ENABLED=0  GOOS=linux GOARCH=arm64 go build  -a -installsuffix cgo  -o broker_arm64
#docker build -f Dockerfile4Armv8  -t "fogflow/broker:arm64"  .


